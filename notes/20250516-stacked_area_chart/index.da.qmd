---
title: "Stakket barchart"
subtitle: "Og en måde at få ram på en besværlig hjemmeside"
author: "Christian Knudsen"
visible: "false" # sæt til noget andet når oplægget/noten er færdigt
categories:
  - kategori 1
date: 2025-05-16
toc: true
image: ""
---

Nu var det egentlig bare et stakket areachart jeg ville lave.
Der skulle bruges noget data. Og jeg fandt en fin
side med sundhedsdata fra australien. Og så var siden bøvlet...

Det er ofte lidt vanskeligt at aflæse. Men hvordan?

Vi skal bruge noget data.


https://www.nhmrc.gov.au/funding/outcomes-and-data-research/research-funding-statistics-and-data

Og vi skal have trukket tabellen ud.

 det er der vist en funktion til et sted.
 

 NHMRC expenditure for research relevant to specific populations 2015 to 2024

```{r eval = FALSE}

library(httr)
library(tidyverse)
library(xml2)
library(rvest)
url <- "https://www.nhmrc.gov.au/funding/outcomes-and-data-research/research-funding-statistics-and-data"
html <- read_html(url)
tables <- html %>% html_elements("table") %>% html_table(fill = TRUE)

length(tables)  # hvor mange tabeller blev fundet
data <- tables[[3]]

data |> 
  pivot_longer(cols = -1) |> 
  mutate(year = str_extract(name, "\\d{4}"), .after = 2) |> 
  mutate(value = as.numeric(value),
  year = as.numeric(year)) |> 
  select(-name) |> 
  ggplot(aes(x = year, y = value, fill = Population)) +
  geom_area()

```

Heraf ses det tydeligt at kvinder er voldsomt underprioriteret. 


```{r}
data |> 
  pivot_longer(cols = -1) |> 
  mutate(year = str_extract(name, "\\d{4}"), .after = 2) |> 
  mutate(value = as.numeric(value),
  year = as.numeric(year)) |> 
      select(-name) |> 
    group_by(year) |> 
    mutate(andel = value/sum(value)) |> 
    ungroup() |> 
    filter(Population == "Women’s Health") 
```


```{r}
data |> 
  pivot_longer(cols = -1) |> 
  mutate(year = str_extract(name, "\\d{4}"), .after = 2) |> 
  mutate(value = as.numeric(value),
  year = as.numeric(year)) |> 
      select(-name) |> 
      mutate(Population = case_when(
        Population == "Women’s Health" ~ "Women’s and maternal Health",
        Population == "Maternal Health" ~ "Women’s and maternal Health",
        .default = Population
      )) |> 
    group_by(year, Population) |> 
    summarise(value = sum(value)) |> 
    ungroup() |> 
    group_by(year) |> 
    mutate(andel = value/sum(value)) |> 
    ungroup() |> 
    filter(Population == "Women’s and maternal Health") 
```

Selv hvis man lægger womens og maternal health samme, kommer den ikke over 38.6% 